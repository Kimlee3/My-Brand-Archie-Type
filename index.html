<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>다계층 마인드맵</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="toolbar">
    <button id="save-btn">💾 저장</button>
    <button id="load-btn">📂 불러오기</button>
    <button id="reset-btn">🔄 초기화</button>
    <input type="file" id="file-input" accept=".mindmap" style="display:none;">
  </div>
  
  <div id="map-container">
    <svg id="connections" style="position:absolute; top:0; left:0; width:100%; height:100%; z-index:0;"></svg>
    <div id="map" style="position:relative; z-index:1;"></div>
  </div>

  <script src="app.js"></script>
  <script>
  document.getElementById('save-btn').addEventListener('click', () => {
    const data = {
      nodes: nodes
        .filter(node => node.element && node.element.querySelector('.node-content')) // ✅ element가 존재하는 노드만 저장
        .map(node => ({
          x: node.x,
          y: node.y,
          text: node.element.querySelector('.node-content').textContent,
          isCentral: node.parent === null,
          direction: node.direction
        })),
      connections: connections.map(conn => ({
        fromIndex: nodes.indexOf(conn.fromNode),
        toIndex: nodes.indexOf(conn.toNode)
      }))
    };

    const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `mindmap-${new Date().toISOString().slice(0, 10)}.mindmap`;
    a.click();
  });
  </script>
</body>
</html>
