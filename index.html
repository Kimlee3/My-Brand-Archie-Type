<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‹¤ê³„ì¸µ ë§ˆì¸ë“œë§µ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="toolbar">
    <button id="save-btn">ğŸ’¾ ì €ì¥</button>
    <button id="load-btn">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <button id="reset-btn">ğŸ”„ ì´ˆê¸°í™”</button>
    <input type="file" id="file-input" accept=".mindmap" style="display:none;">
  </div>
  
  <div id="map-container">
    <svg id="connections" style="position:absolute; top:0; left:0; width:100%; height:100%; z-index:0;"></svg>
    <div id="map" style="position:relative; z-index:1;"></div>
  </div>

  <script src="app.js"></script>
  <script>
    // ì €ì¥ ê¸°ëŠ¥ (ë¡œì»¬ íŒŒì¼ë¡œ ì €ì¥)
    document.getElementById('save-btn').addEventListener('click', () => {
        const data = {
            nodes: nodes.map(node => ({
                x: node.x,
                y: node.y,
                text: node.element.querySelector('.node-content').textContent,
                isCentral: node.parent === null,
                direction: node.direction
            })),
            connections: connections.map(conn => ({
                fromIndex: nodes.indexOf(conn.fromNode),
                toIndex: nodes.indexOf(conn.toNode)
            }))
        };

        // JSON íŒŒì¼ ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
        const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `mindmap-${new Date().toISOString().slice(0, 10)}.mindmap`;
        a.click();
    });

    // ì´ˆê¸°í™” ë²„íŠ¼ ê¸°ëŠ¥
    document.getElementById('reset-btn').addEventListener('click', () => {
        if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            nodes = [];
            connections = [];
            document.getElementById('map').innerHTML = '';
            document.getElementById('connections').innerHTML = '';

            // ì¤‘ì•™ ë…¸ë“œ ìƒì„±
            const centerX = document.getElementById('map-container').offsetWidth / 2 - 50;
            const centerY = document.getElementById('map-container').offsetHeight / 2 - 25;
            const centralNode = createNode(centerX, centerY, 'ë©”ì¸ ë…¸ë“œ', null);
            nodes.push(centralNode);
        }
    });

    // ë¶ˆëŸ¬ì˜¤ê¸° ê¸°ëŠ¥
    document.getElementById('load-btn').addEventListener('click', () => {
        document.getElementById('file-input').click();
    });

    document.getElementById('file-input').addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const data = JSON.parse(e.target.result);
                nodes = [];
                connections = [];
                document.getElementById('map').innerHTML = '';
                document.getElementById('connections').innerHTML = '';

                // ë…¸ë“œ ë³µì›
                data.nodes.forEach(nodeData => {
                    const node = createNode(nodeData.x, nodeData.y, nodeData.text, nodeData.isCentral ? null : {});
                    nodes.push(node);
                });

                // ì—°ê²°ì„  ë³µì›
                data.connections.forEach(conn => {
                    const fromNode = nodes[conn.fromIndex];
                    const toNode = nodes[conn.toIndex];
                    createConnection(fromNode, toNode);
                });
            } catch (error) {
                alert('íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        };
        reader.readAsText(file);
    });
  </script>
</body>
</html>